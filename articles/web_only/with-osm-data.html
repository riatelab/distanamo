<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Creating a distance cartogram using OSM data • distanamo</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<script src="../../lightswitch.js"></script><script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../../deps/headroom-0.11.0/headroom.min.js"></script><script src="../../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../../deps/search-1.0.0/fuse.min.js"></script><script src="../../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Creating a distance cartogram using OSM data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../../index.html">distanamo</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../../articles/distanamo.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../../articles/web_only/with-osm-data.html">Creating a distance cartogram using OSM data</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/riatelab/distanamo/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../../logo.png" class="logo" alt=""><h1>Creating a distance cartogram using OSM data</h1>
                        <h4 data-toc-skip class="author">Matthieu
Viry</h4>
            
            <h4 data-toc-skip class="date">2025-04-10</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/riatelab/distanamo/blob/HEAD/vignettes/web_only/with-osm-data.Rmd" class="external-link"><code>vignettes/web_only/with-osm-data.Rmd</code></a></small>
      <div class="d-none name"><code>with-osm-data.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>We are looking to build a unipolar distance cartogram (also called a
<em>centered time cartogram</em>) using only data from OpenStreetMap
(OSM): it is going to use both geographic layers describing the
territory and travel time data from OSM.</p>
<p>This type of cartogram visualizes travelling times from a reference
starting location to other destinations in a selected area. In the
resulting map, the geographic distance is replaced by time distance and
the underlying map layers are deformed accordingly.</p>
<p>This highlights the use of several packages developed at <a href="https://github.com/riatelab" class="external-link">RIATE</a>, including:</p>
<ul>
<li>
<code>mapsf</code> to create maps with <code>sf</code> objects,</li>
<li>
<code>osrm</code> for calculating distance-time matrices from OSM
data and an OSRM instance,</li>
<li>
<code>valh</code> for calculating distance-time matrices from OSM
data and a Valhalla instance,</li>
<li>
<code>maposm</code> to easily retrieve OSM data (this is a wrapper
around <code>osmdata</code>),</li>
<li>
<code>distanamo</code> for creating distance cartograms.</li>
</ul>
</div>
<div class="section level2">
<h2 id="installing-and-importing-packages">Installing and importing packages<a class="anchor" aria-label="anchor" href="#installing-and-importing-packages"></a>
</h2>
<p><code>mapsf</code> and <code>osrm</code> are available both on CRAN
and on <a href="https://riatelab.r-universe.dev/builds" class="external-link">riatelab’s
r-universe</a> while <code>distanamo</code> and <code>maposm</code> are
only available from <a href="https://riatelab.r-universe.dev/builds" class="external-link">riatelab’s
r-universe</a>.</p>
<p>As a result, we propose to install all the packages from
r-universe:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">repos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"https://riatelab.r-universe.dev"</span>, <span class="st">"https://cloud.r-project.org"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"mapsf"</span>, repos <span class="op">=</span> <span class="va">repos</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"osrm"</span>, repos <span class="op">=</span> <span class="va">repos</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"distanamo"</span>, repos <span class="op">=</span> <span class="va">repos</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"maposm"</span>, repos <span class="op">=</span> <span class="va">repos</span><span class="op">)</span></span></code></pre></div>
<p>Once installed, we can import the necessary packages:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://riatelab.github.io/mapsf/" class="external-link">mapsf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/riatelab/osrm" class="external-link">osrm</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">maposm</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://riatelab.github.io/distanamo/">distanamo</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fetching-osm-data">Fetching OSM data<a class="anchor" aria-label="anchor" href="#fetching-osm-data"></a>
</h2>
<p>We are now retrieving OSM data for the study area of our choice: here
we are interested in the accessibility (by foot, but we will see this
later) from the market hall of Chambéry.</p>
<p>Let’s get the coordinates of the address of Chambéry’s market hall
and then fetch the data for a radius of 3000 meters around it:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bb</span> <span class="op">&lt;-</span> <span class="fu">osmdata</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/osmdata/reference/getbb.html" class="external-link">getbb</a></span><span class="op">(</span><span class="st">"10, Place Georges Clemenceau, 73100 Chambéry, France"</span><span class="op">)</span></span>
<span><span class="va">lon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">bb</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="va">lat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">bb</span><span class="op">[</span><span class="fl">2</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/maposm/man/om_get.html" class="external-link">om_get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lon</span>, <span class="va">lat</span><span class="op">)</span>, r <span class="op">=</span> <span class="fl">3000</span><span class="op">)</span></span>
<span><span class="co">#&gt; Getting urban areas: 29.186 sec elapsed</span></span>
<span><span class="co">#&gt; Getting green areas: 20.762 sec elapsed</span></span>
<span><span class="co">#&gt; Getting roads: 18.48 sec elapsed</span></span>
<span><span class="co">#&gt; Getting streets: 20.314 sec elapsed</span></span>
<span><span class="co">#&gt; Getting railways: 0.681 sec elapsed</span></span>
<span><span class="co">#&gt; Getting water bodies: 4.091 sec elapsed</span></span></code></pre></div>
<p>We can see that the resulting object is a list of sf layers:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "zone"     "urban"    "building" "green"    "road"     "street"   "railway" </span></span>
<span><span class="co">#&gt; [8] "water"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="defining-a-reference-point">Defining a reference point<a class="anchor" aria-label="anchor" href="#defining-a-reference-point"></a>
</h2>
<p>We need to define a reference point from which the travel times will
be computed. Since we used the address of Chambéry’s market hall as a
center point to fetch the data, we can use the center of the circle that
includes all the data:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_centroid</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">zone</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="sampling-points">Sampling points<a class="anchor" aria-label="anchor" href="#sampling-points"></a>
</h2>
<p>We then need a set of destinations to compute the travel times to. To
do so, we sample roughly 200 points on the road network. Note that we
use both the road and street network layers here, but in some cases
(particularly when using a <em>car</em> profile) it may be appropriate
to use only the road network.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_sample.html" class="external-link">st_sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">road</span>, <span class="va">res</span><span class="op">$</span><span class="va">street</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">200</span>, type <span class="op">=</span> <span class="st">"regular"</span><span class="op">)</span></span>
<span><span class="co"># Or if you want to use only the road network:</span></span>
<span><span class="co"># x &lt;- st_sample(res$road, size = 200, type = "regular")</span></span>
<span><span class="va">points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, geom <span class="op">=</span> <span class="va">x</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">points</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="with-osm-data_files/figure-html/unnamed-chunk-6-1.png" width="768"></p>
</div>
<div class="section level2">
<h2 id="making-a-map-of-the-result">Making a map of the result<a class="anchor" aria-label="anchor" href="#making-a-map-of-the-result"></a>
</h2>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://riatelab.github.io/mapsf/reference/mf_map.html" class="external-link">mf_map</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">zone</span>, col <span class="op">=</span> <span class="st">"#f2efe9"</span>, border <span class="op">=</span> <span class="cn">NA</span>, add <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://riatelab.github.io/mapsf/reference/mf_map.html" class="external-link">mf_map</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">green</span>, col <span class="op">=</span> <span class="st">"#c8facc"</span>, border <span class="op">=</span> <span class="st">"#c8facc"</span>, lwd <span class="op">=</span> <span class="fl">.5</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://riatelab.github.io/mapsf/reference/mf_map.html" class="external-link">mf_map</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">water</span>, col <span class="op">=</span> <span class="st">"#aad3df"</span>, border <span class="op">=</span> <span class="st">"#aad3df"</span>, lwd <span class="op">=</span> <span class="fl">.5</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://riatelab.github.io/mapsf/reference/mf_map.html" class="external-link">mf_map</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">railway</span>, col <span class="op">=</span> <span class="st">"grey50"</span>, lty <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">.2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://riatelab.github.io/mapsf/reference/mf_map.html" class="external-link">mf_map</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">road</span>, col <span class="op">=</span> <span class="st">"white"</span>, border <span class="op">=</span> <span class="st">"white"</span>, lwd <span class="op">=</span> <span class="fl">.5</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://riatelab.github.io/mapsf/reference/mf_map.html" class="external-link">mf_map</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">street</span>, col <span class="op">=</span> <span class="st">"white"</span>, border <span class="op">=</span> <span class="st">"white"</span>, lwd <span class="op">=</span> <span class="fl">.5</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://riatelab.github.io/mapsf/reference/mf_map.html" class="external-link">mf_map</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">building</span>, col <span class="op">=</span> <span class="st">"#d9d0c9"</span>, border <span class="op">=</span> <span class="st">"#c6bab1"</span>, lwd <span class="op">=</span> <span class="fl">.5</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://riatelab.github.io/mapsf/reference/mf_map.html" class="external-link">mf_map</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">zone</span>, col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span> <span class="st">"#c6bab1"</span>, lwd <span class="op">=</span> <span class="fl">4</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://riatelab.github.io/mapsf/reference/mf_map.html" class="external-link">mf_map</a></span><span class="op">(</span><span class="va">start</span>, pch <span class="op">=</span> <span class="fl">23</span>, col <span class="op">=</span> <span class="st">"red"</span>, cex <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://riatelab.github.io/mapsf/reference/mf_map.html" class="external-link">mf_map</a></span><span class="op">(</span><span class="va">points</span>, add <span class="op">=</span> <span class="cn">T</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span></code></pre></div>
<p><img src="with-osm-data_files/figure-html/unnamed-chunk-7-1.png" width="768"></p>
</div>
<div class="section level2">
<h2 id="computing-travel-times-between-the-reference-point-and-the-sampled-points">Computing travel times between the reference point and the sampled
points<a class="anchor" aria-label="anchor" href="#computing-travel-times-between-the-reference-point-and-the-sampled-points"></a>
</h2>
<p>To do so, we can use the <code>osrmTable</code> function from the
<code>osrm</code> package:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/osrm/man/osrmTable.html" class="external-link">osrmTable</a></span><span class="op">(</span></span>
<span>  src <span class="op">=</span> <span class="va">start</span>,</span>
<span>  dst <span class="op">=</span> <span class="va">points</span>,</span>
<span>  osrm.profile <span class="op">=</span> <span class="st">"foot"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">points</span><span class="op">$</span><span class="va">durations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">mat</span><span class="op">$</span><span class="va">durations</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="alternative-to-osrm-for-computing-travel-times">Alternative to OSRM for computing travel times<a class="anchor" aria-label="anchor" href="#alternative-to-osrm-for-computing-travel-times"></a>
</h3>
<p>Alternatively, if having a Valhalla instance on hand and if the data
preparation step included elevation data, you can also use it to compute
travel times and benefit from taking the elevation into account:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"valh"</span>, repos <span class="op">=</span> <span class="va">repos</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/riatelab/valh" class="external-link">valh</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">mat_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/valh/man/vl_matrix.html" class="external-link">vl_matrix</a></span><span class="op">(</span></span>
<span>  src <span class="op">=</span> <span class="va">start</span>,</span>
<span>  dst <span class="op">=</span> <span class="va">points</span>,</span>
<span>  costing <span class="op">=</span> <span class="st">"pedestrian"</span>,</span>
<span>  server <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"VALHALLA_URL"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">points</span><span class="op">$</span><span class="va">durations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">mat_val</span><span class="op">$</span><span class="va">durations</span><span class="op">)</span></span></code></pre></div>
<p>Note that we use an environment variable to store the url of the
Valhalla instance because this is our private instance. You need to
replace <code>Sys.getenv('VALHALLA_URL')</code> by the actual value you
want to use.</p>
</div>
</div>
<div class="section level2">
<h2 id="computing-the-positions-of-image-points">Computing the positions of image points<a class="anchor" aria-label="anchor" href="#computing-the-positions-of-image-points"></a>
</h2>
<p>We can now compute the positions of the image points using the
<code>dc_move_from_reference_point</code> function. It takes as input
the reference point, the other points, and the column name of the travel
times in the <code>other_points</code> object.</p>
<p>This function will move the points by computing the reference speed
(the average distance / time) and then moving the points further or
closer to the reference point depending on the travel time to reach
them.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pos_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/dc_move_from_reference_point.html">dc_move_from_reference_point</a></span><span class="op">(</span></span>
<span>  reference_point <span class="op">=</span> <span class="va">start</span>,</span>
<span>  other_points <span class="op">=</span> <span class="va">points</span>,</span>
<span>  duration_col_name <span class="op">=</span> <span class="st">"durations"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can call the <code>summary</code> function to obtain a summary of
the resulting object:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">pos_result</span><span class="op">)</span></span>
<span><span class="co">#&gt; Summary of the unipolar displacement result:</span></span>
<span><span class="co">#&gt; Min displacement: 3.692405 [m] </span></span>
<span><span class="co">#&gt; Mean displacement: 359.9702 [m] </span></span>
<span><span class="co">#&gt; Max displacement: 1276.343 [m]</span></span></code></pre></div>
<p>We can also plot the resulting object to visualize the positions of
the image points and how they have been moved:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pos_result</span><span class="op">)</span></span></code></pre></div>
<p><img src="with-osm-data_files/figure-html/unnamed-chunk-12-1.png" width="768"></p>
</div>
<div class="section level2">
<h2 id="creating-the-concentric-circles">Creating the concentric circles<a class="anchor" aria-label="anchor" href="#creating-the-concentric-circles"></a>
</h2>
<p>Since the cartogram will replace the geographic distance by time
distance we can create concentric circles to represent the time distance
from the reference point. Internally, this is possible because the
reference speed has been stored in the resulting object of the
<code>dc_move_from_reference_point</code> function.</p>
<p>The <code>steps</code> parameter is a list of the time distances we
want to represent in the cartogram, in the same unit as the travel times
(here, minutes).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">circles</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/dc_concentric_circles.html">dc_concentric_circles</a></span><span class="op">(</span></span>
<span>  <span class="va">pos_result</span>,</span>
<span>  steps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">40</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">circles</span></span>
<span><span class="co">#&gt; Simple feature collection with 4 features and 1 field</span></span>
<span><span class="co">#&gt; Geometry type: LINESTRING</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 654600.8 ymin: 5728074 xmax: 661118.7 ymax: 5734592</span></span>
<span><span class="co">#&gt; Projected CRS: WGS 84 / Pseudo-Mercator</span></span>
<span><span class="co">#&gt;   step                       geometry</span></span>
<span><span class="co">#&gt; 1   10 LINESTRING (658674.5 573133...</span></span>
<span><span class="co">#&gt; 2   20 LINESTRING (659489.3 573133...</span></span>
<span><span class="co">#&gt; 3   30 LINESTRING (660304 5731333,...</span></span>
<span><span class="co">#&gt; 4   40 LINESTRING (661118.7 573133...</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="creating-the-distance-cartogram">Creating the distance cartogram<a class="anchor" aria-label="anchor" href="#creating-the-distance-cartogram"></a>
</h2>
<p>We first need to compute the bounding box of all the layers we want
to deform using the interpolation grid to ensure that the interpolation
grid covers the whole area of interest.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bbox</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/dc_combine_bbox.html">dc_combine_bbox</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></code></pre></div>
<p>We can then create the interpolation grid:</p>
<p>The <code>precision</code> parameters controls the size of the grid
cells (higher is more precise, for example 0.5 generally gives a coarse
result, 2 a satisfactory result and 4 a particularly fine result). A
precision of 2 is usually a good default value and this is what we
choose to use here.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">igrid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/dc_create.html">dc_create</a></span><span class="op">(</span></span>
<span>  source_points <span class="op">=</span> <span class="va">pos_result</span><span class="op">$</span><span class="va">source_points</span>,</span>
<span>  image_points <span class="op">=</span> <span class="va">pos_result</span><span class="op">$</span><span class="va">image_points</span>,</span>
<span>  precision <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  bbox <span class="op">=</span> <span class="va">bbox</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Various information can be obtained from the interpolation grid:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">igrid</span><span class="op">)</span></span>
<span><span class="co">#&gt; Summary of the interpolation grid:</span></span>
<span><span class="co">#&gt; Number of cells: 900 </span></span>
<span><span class="co">#&gt; Precision: 211.693 (α = 2) </span></span>
<span><span class="co">#&gt; Deformation strength: 1.177372 </span></span>
<span><span class="co">#&gt; Mean absolute error: 50.96566 </span></span>
<span><span class="co">#&gt; RMSE (interp - image): 66.48959 </span></span>
<span><span class="co">#&gt; RMSE x (interp - image): 48.76218 </span></span>
<span><span class="co">#&gt; RMSE y (interp - image): 45.20084 </span></span>
<span><span class="co">#&gt; RMSE (interp - source): 426.2467 </span></span>
<span><span class="co">#&gt; RMSE x (interp - source): 313.5549 </span></span>
<span><span class="co">#&gt; RMSE y (interp - source): 288.7378 </span></span>
<span><span class="co">#&gt; R squared: 0.9989954</span></span></code></pre></div>
<p>We can also plot the interpolation grid to visualize the source grid,
the interpolated grid, the distance between the image points and the
interpolated points, and the strength of the deformation.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">igrid</span><span class="op">)</span></span></code></pre></div>
<p><img src="with-osm-data_files/figure-html/unnamed-chunk-17-1.png" width="768"><img src="with-osm-data_files/figure-html/unnamed-chunk-17-2.png" width="768"><img src="with-osm-data_files/figure-html/unnamed-chunk-17-3.png" width="768"><img src="with-osm-data_files/figure-html/unnamed-chunk-17-4.png" width="768"></p>
</div>
<div class="section level2">
<h2 id="deforming-the-background-layers">Deforming the background layers<a class="anchor" aria-label="anchor" href="#deforming-the-background-layers"></a>
</h2>
<p>Since we have multiple layers to deform, we can use the
<code>dc_interpolate_parallel</code> function to deform all the layers
at once:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">deformed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/dc_interpolate_parallel.html">dc_interpolate_parallel</a></span><span class="op">(</span><span class="va">igrid</span>, <span class="va">res</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="mapping-the-result">Mapping the result<a class="anchor" aria-label="anchor" href="#mapping-the-result"></a>
</h2>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://riatelab.github.io/mapsf/reference/mf_map.html" class="external-link">mf_map</a></span><span class="op">(</span><span class="va">deformed</span><span class="op">$</span><span class="va">zone</span>, col <span class="op">=</span> <span class="st">"#f2efe9"</span>, border <span class="op">=</span> <span class="cn">NA</span>, add <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://riatelab.github.io/mapsf/reference/mf_map.html" class="external-link">mf_map</a></span><span class="op">(</span><span class="va">deformed</span><span class="op">$</span><span class="va">green</span>, col <span class="op">=</span> <span class="st">"#c8facc"</span>, border <span class="op">=</span> <span class="st">"#c8facc"</span>, lwd <span class="op">=</span> <span class="fl">.5</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://riatelab.github.io/mapsf/reference/mf_map.html" class="external-link">mf_map</a></span><span class="op">(</span><span class="va">deformed</span><span class="op">$</span><span class="va">water</span>, col <span class="op">=</span> <span class="st">"#aad3df"</span>, border <span class="op">=</span> <span class="st">"#aad3df"</span>, lwd <span class="op">=</span> <span class="fl">.5</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://riatelab.github.io/mapsf/reference/mf_map.html" class="external-link">mf_map</a></span><span class="op">(</span><span class="va">deformed</span><span class="op">$</span><span class="va">railway</span>, col <span class="op">=</span> <span class="st">"grey50"</span>, lty <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">.2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://riatelab.github.io/mapsf/reference/mf_map.html" class="external-link">mf_map</a></span><span class="op">(</span><span class="va">deformed</span><span class="op">$</span><span class="va">road</span>, col <span class="op">=</span> <span class="st">"white"</span>, border <span class="op">=</span> <span class="st">"white"</span>, lwd <span class="op">=</span> <span class="fl">.5</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://riatelab.github.io/mapsf/reference/mf_map.html" class="external-link">mf_map</a></span><span class="op">(</span><span class="va">deformed</span><span class="op">$</span><span class="va">street</span>, col <span class="op">=</span> <span class="st">"white"</span>, border <span class="op">=</span> <span class="st">"white"</span>, lwd <span class="op">=</span> <span class="fl">.5</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://riatelab.github.io/mapsf/reference/mf_map.html" class="external-link">mf_map</a></span><span class="op">(</span><span class="va">deformed</span><span class="op">$</span><span class="va">building</span>, col <span class="op">=</span> <span class="st">"#d9d0c9"</span>, border <span class="op">=</span> <span class="st">"#c6bab1"</span>, lwd <span class="op">=</span> <span class="fl">.5</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://riatelab.github.io/mapsf/reference/mf_map.html" class="external-link">mf_map</a></span><span class="op">(</span><span class="va">deformed</span><span class="op">$</span><span class="va">zone</span>, col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span> <span class="st">"#c6bab1"</span>, lwd <span class="op">=</span> <span class="fl">4</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://riatelab.github.io/mapsf/reference/mf_map.html" class="external-link">mf_map</a></span><span class="op">(</span><span class="va">igrid</span><span class="op">$</span><span class="va">interpolated_grid</span>, col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span> <span class="st">"#940000"</span>, lwd <span class="op">=</span> <span class="fl">.1</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://riatelab.github.io/mapsf/reference/mf_map.html" class="external-link">mf_map</a></span><span class="op">(</span><span class="va">start</span>, pch <span class="op">=</span> <span class="fl">16</span>, col <span class="op">=</span> <span class="st">"red"</span>, cex <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://riatelab.github.io/mapsf/reference/mf_map.html" class="external-link">mf_map</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html" class="external-link">st_intersection</a></span><span class="op">(</span><span class="va">circles</span>, <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html" class="external-link">st_union</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_buffer</a></span><span class="op">(</span><span class="va">igrid</span><span class="op">$</span><span class="va">interpolated_grid</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       col <span class="op">=</span> <span class="st">"red"</span>, lty <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">mapsf</span><span class="fu">:::</span><span class="fu">shadowtext</span><span class="op">(</span></span>
<span>    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">circles</span><span class="op">$</span><span class="va">geometry</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">xmax</span>,</span>
<span>    <span class="va">start</span><span class="op">$</span><span class="va">geometry</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">i</span> <span class="op">*</span> <span class="fl">10</span>, <span class="st">"min"</span><span class="op">)</span>,</span>
<span>    col <span class="op">=</span> <span class="st">"purple"</span>,</span>
<span>    bg <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>    r <span class="op">=</span> <span class="fl">0.15</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="with-osm-data_files/figure-html/unnamed-chunk-19-1.png" width="768"></p>
<p>If needed, we can add the various points (or a sample of them) and
their corresponding travel times to see that the deformation has been
correctly applied:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mvd_pts</span> <span class="op">&lt;-</span> <span class="va">igrid</span><span class="op">$</span><span class="va">interpolated_points</span></span>
<span><span class="va">mvd_pts</span><span class="op">$</span><span class="va">durations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">points</span><span class="op">$</span><span class="va">durations</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://riatelab.github.io/mapsf/reference/mf_map.html" class="external-link">mf_map</a></span><span class="op">(</span><span class="va">deformed</span><span class="op">$</span><span class="va">zone</span>, col <span class="op">=</span> <span class="st">"#f2efe9"</span>, border <span class="op">=</span> <span class="cn">NA</span>, add <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://riatelab.github.io/mapsf/reference/mf_map.html" class="external-link">mf_map</a></span><span class="op">(</span><span class="va">deformed</span><span class="op">$</span><span class="va">green</span>, col <span class="op">=</span> <span class="st">"#c8facc"</span>, border <span class="op">=</span> <span class="st">"#c8facc"</span>, lwd <span class="op">=</span> <span class="fl">.5</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://riatelab.github.io/mapsf/reference/mf_map.html" class="external-link">mf_map</a></span><span class="op">(</span><span class="va">deformed</span><span class="op">$</span><span class="va">water</span>, col <span class="op">=</span> <span class="st">"#aad3df"</span>, border <span class="op">=</span> <span class="st">"#aad3df"</span>, lwd <span class="op">=</span> <span class="fl">.5</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://riatelab.github.io/mapsf/reference/mf_map.html" class="external-link">mf_map</a></span><span class="op">(</span><span class="va">deformed</span><span class="op">$</span><span class="va">railway</span>, col <span class="op">=</span> <span class="st">"grey50"</span>, lty <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">.2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://riatelab.github.io/mapsf/reference/mf_map.html" class="external-link">mf_map</a></span><span class="op">(</span><span class="va">deformed</span><span class="op">$</span><span class="va">road</span>, col <span class="op">=</span> <span class="st">"white"</span>, border <span class="op">=</span> <span class="st">"white"</span>, lwd <span class="op">=</span> <span class="fl">.5</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://riatelab.github.io/mapsf/reference/mf_map.html" class="external-link">mf_map</a></span><span class="op">(</span><span class="va">deformed</span><span class="op">$</span><span class="va">street</span>, col <span class="op">=</span> <span class="st">"white"</span>, border <span class="op">=</span> <span class="st">"white"</span>, lwd <span class="op">=</span> <span class="fl">.5</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://riatelab.github.io/mapsf/reference/mf_map.html" class="external-link">mf_map</a></span><span class="op">(</span><span class="va">deformed</span><span class="op">$</span><span class="va">building</span>, col <span class="op">=</span> <span class="st">"#d9d0c9"</span>, border <span class="op">=</span> <span class="st">"#c6bab1"</span>, lwd <span class="op">=</span> <span class="fl">.5</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://riatelab.github.io/mapsf/reference/mf_map.html" class="external-link">mf_map</a></span><span class="op">(</span><span class="va">deformed</span><span class="op">$</span><span class="va">zone</span>, col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span> <span class="st">"#c6bab1"</span>, lwd <span class="op">=</span> <span class="fl">4</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://riatelab.github.io/mapsf/reference/mf_map.html" class="external-link">mf_map</a></span><span class="op">(</span><span class="va">igrid</span><span class="op">$</span><span class="va">interpolated_grid</span>, col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span> <span class="st">"#940000"</span>, lwd <span class="op">=</span> <span class="fl">.1</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://riatelab.github.io/mapsf/reference/mf_map.html" class="external-link">mf_map</a></span><span class="op">(</span><span class="va">start</span>, pch <span class="op">=</span> <span class="fl">16</span>, col <span class="op">=</span> <span class="st">"red"</span>, cex <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://riatelab.github.io/mapsf/reference/mf_map.html" class="external-link">mf_map</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html" class="external-link">st_intersection</a></span><span class="op">(</span><span class="va">circles</span>, <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html" class="external-link">st_union</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_buffer</a></span><span class="op">(</span><span class="va">igrid</span><span class="op">$</span><span class="va">interpolated_grid</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, </span>
<span>       col <span class="op">=</span> <span class="st">"red"</span>, lty <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">mapsf</span><span class="fu">:::</span><span class="fu">shadowtext</span><span class="op">(</span></span>
<span>    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">circles</span><span class="op">$</span><span class="va">geometry</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">xmax</span>,</span>
<span>    <span class="va">start</span><span class="op">$</span><span class="va">geometry</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">i</span> <span class="op">*</span> <span class="fl">10</span>, <span class="st">"min"</span><span class="op">)</span>,</span>
<span>    col <span class="op">=</span> <span class="st">"purple"</span>,</span>
<span>    bg <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>    r <span class="op">=</span> <span class="fl">0.15</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://riatelab.github.io/mapsf/reference/mf_map.html" class="external-link">mf_map</a></span><span class="op">(</span><span class="va">mvd_pts</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://riatelab.github.io/mapsf/reference/mf_label.html" class="external-link">mf_label</a></span><span class="op">(</span><span class="va">mvd_pts</span>, var <span class="op">=</span> <span class="st">"durations"</span>, col <span class="op">=</span> <span class="st">"black"</span>, halo <span class="op">=</span> <span class="cn">TRUE</span>, overlap <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="with-osm-data_files/figure-html/unnamed-chunk-20-1.png" width="768"></p>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>Distance cartograms are both a way of analyzing the accessibility of
a territory and a way of depicting it. In the case of <em>unipolar</em>
cartograms, as proposed here, reading is generally fairly
straightforward, making it easy to highlight portions of the territory
that are difficult (or at least more difficult than the average) to
reach for example. The addition of concentric circles at regular time
steps makes it possible to quickly assess the time distance of a portion
of the territory from the reference point.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matthieu Viry.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
