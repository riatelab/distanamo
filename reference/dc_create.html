<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Create an interpolation grid — dc_create • distanamo</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create an interpolation grid — dc_create"><meta name="description" content="Create a new interpolation grid which covers the source points and with a cell size
deduced from the precision.
The grid is then interpolated to match the
image points. This then allows one to interpolate any point on the grid
(enabling the deformation of geometries such as background layers)
and to retrieve useful metrics about the deformation.
If the bbox provided does not cover all the source points, the grid will
be extended to cover all the source points.
The precision controls the size of the grid cells (higher is more precise,
for example 0.5 generally gives a coarse result, 2 a satisfactory result
and 4 a particularly fine result). A precision of 2 is usually a good
default value.
The number of iterations controls the number of iterations for the
interpolation. It is generally 4 times the square root of the number of
points (and this is the default value it the niter parameter is not
provided.
Note that the number of source points must be equal to the number of
image points, and either they must be supplied in the same order
(as they are homologous points), or the name of a field containing
an identifier must be supplied to enable them to be sorted in the
same order."><meta property="og:description" content="Create a new interpolation grid which covers the source points and with a cell size
deduced from the precision.
The grid is then interpolated to match the
image points. This then allows one to interpolate any point on the grid
(enabling the deformation of geometries such as background layers)
and to retrieve useful metrics about the deformation.
If the bbox provided does not cover all the source points, the grid will
be extended to cover all the source points.
The precision controls the size of the grid cells (higher is more precise,
for example 0.5 generally gives a coarse result, 2 a satisfactory result
and 4 a particularly fine result). A precision of 2 is usually a good
default value.
The number of iterations controls the number of iterations for the
interpolation. It is generally 4 times the square root of the number of
points (and this is the default value it the niter parameter is not
provided.
Note that the number of source points must be equal to the number of
image points, and either they must be supplied in the same order
(as they are homologous points), or the name of a field containing
an identifier must be supplied to enable them to be sorted in the
same order."><meta property="og:image" content="https://riatelab.github.io/distanamo/reference/figures/logo.png"><meta property="og:image:alt" content="Distanamo logo"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">distanamo</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/distanamo.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/web_only/with-osm-data.html">Creating a distance cartogram using OSM data</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/riatelab/distanamo/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Create an interpolation grid</h1>
      <small class="dont-index">Source: <a href="https://github.com/riatelab/distanamo/blob/HEAD/R/dc_create.R" class="external-link"><code>R/dc_create.R</code></a></small>
      <div class="d-none name"><code>dc_create.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Create a new interpolation grid which covers the source points and with a cell size
deduced from the precision.</p>
<p>The grid is then interpolated to match the
image points. This then allows one to interpolate any point on the grid
(enabling the deformation of geometries such as background layers)
and to retrieve useful metrics about the deformation.</p>
<p>If the bbox provided does not cover all the source points, the grid will
be extended to cover all the source points.</p>
<p>The precision controls the size of the grid cells (higher is more precise,
for example 0.5 generally gives a coarse result, 2 a satisfactory result
and 4 a particularly fine result). A precision of 2 is usually a good
default value.</p>
<p>The number of iterations controls the number of iterations for the
interpolation. It is generally 4 times the square root of the number of
points (and this is the default value it the niter parameter is not
provided.</p>
<p>Note that the number of source points must be equal to the number of
image points, and either they must be supplied in the same order
(as they are homologous points), or the name of a field containing
an identifier must be supplied to enable them to be sorted in the
same order.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">dc_create</span><span class="op">(</span><span class="va">source_points</span>, <span class="va">image_points</span>, <span class="va">precision</span>, <span class="va">bbox</span>, <span class="va">niter</span>, <span class="va">sort_by</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-source-points">source_points<a class="anchor" aria-label="anchor" href="#arg-source-points"></a></dt>
<dd><p>The source point layer, sf POINT object</p></dd>


<dt id="arg-image-points">image_points<a class="anchor" aria-label="anchor" href="#arg-image-points"></a></dt>
<dd><p>The image point layer, sf POINT object</p></dd>


<dt id="arg-precision">precision<a class="anchor" aria-label="anchor" href="#arg-precision"></a></dt>
<dd><p>The precision of the grid to be created
(a higher value means a higher precision - 0.5 gives usually a coarse result,
2 is good default, 4 is very detailed)</p></dd>


<dt id="arg-bbox">bbox<a class="anchor" aria-label="anchor" href="#arg-bbox"></a></dt>
<dd><p>The bounding box of the grid to be created</p></dd>


<dt id="arg-niter">niter<a class="anchor" aria-label="anchor" href="#arg-niter"></a></dt>
<dd><p>The number of iterations
(default is <code>floor(4 * sqrt(length(source_points)))</code>)</p></dd>


<dt id="arg-sort-by">sort_by<a class="anchor" aria-label="anchor" href="#arg-sort-by"></a></dt>
<dd><p>The field to sort the source and image points by</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An interpolation grid to be used to transform the layers</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Read source points</span></span></span>
<span class="r-in"><span><span class="va">source_pts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  dsn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"gpkg/data-prefecture.gpkg"</span>, package <span class="op">=</span> <span class="st">"distanamo"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  layer <span class="op">=</span> <span class="st">"prefecture"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Read image points</span></span></span>
<span class="r-in"><span><span class="va">image_pts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  dsn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"gpkg/data-prefecture.gpkg"</span>, package <span class="op">=</span> <span class="st">"distanamo"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  layer <span class="op">=</span> <span class="st">"image-points"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Read the background layer to deform</span></span></span>
<span class="r-in"><span><span class="va">background_layer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  dsn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"gpkg/data-prefecture.gpkg"</span>, package <span class="op">=</span> <span class="st">"distanamo"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  layer <span class="op">=</span> <span class="st">"departement"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create the interpolation grid</span></span></span>
<span class="r-in"><span><span class="va">igrid</span> <span class="op">&lt;-</span> <span class="fu">dc_create</span><span class="op">(</span></span></span>
<span class="r-in"><span>  source_points <span class="op">=</span> <span class="va">source_pts</span>,</span></span>
<span class="r-in"><span>  image_points <span class="op">=</span> <span class="va">image_pts</span>,</span></span>
<span class="r-in"><span>  precision <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>  bbox <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">background_layer</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot various depictions of the interpolation grid</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">igrid</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="dc_create-1.png" alt="" width="700" height="433"></span>
<span class="r-plt img"><img src="dc_create-2.png" alt="" width="700" height="433"></span>
<span class="r-plt img"><img src="dc_create-3.png" alt="" width="700" height="433"></span>
<span class="r-plt img"><img src="dc_create-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Useful information about the interpolation grid</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">igrid</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of the interpolation grid:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of cells: 441 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Precision: 50462.76 (α = 2) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Deformation strength: 1.041534 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Mean absolute error: 3734.717 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> RMSE (interp - image): 4989.972 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> RMSE x (interp - image): 4060.84 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> RMSE y (interp - image): 2899.896 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> RMSE (interp - source): 42725.87 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> RMSE x (interp - source): 32080.25 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> RMSE y (interp - source): 28219.8 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> R squared: 0.9997285 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Deform the target layer</span></span></span>
<span class="r-in"><span><span class="va">background_deformed</span> <span class="op">&lt;-</span> <span class="fu"><a href="dc_interpolate.html">dc_interpolate</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  interpolation_grid <span class="op">=</span> <span class="va">igrid</span>,</span></span>
<span class="r-in"><span>  layer_to_deform <span class="op">=</span> <span class="va">background_layer</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">background_deformed</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="dc_create-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matthieu Viry.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

